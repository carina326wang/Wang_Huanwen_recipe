<!doctype html>
<html>
<head>
<title>Carina's Space</title>
<link href="style.css" rel="stylesheet" type="text/css" charset="utf-8">
<link href="tipsy.css" rel="stylesheet" type="text/css" charset="utf-8">
<link href='http://fonts.googleapis.com/css?family=Coming+Soon' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'>

<script src="https://www.parsecdn.com/js/parse-1.3.1.min.js"></script>
<script src="jquery-1.11.1.min.js"></script>
<script src="jquery.tipsy.js"></script>

</head>

<body>

<div class="greeting">
	<h1>Book me early~ See you all in January *^<span id="mouth">_</span>^* <br>-XOXO Huan</h1>
	<p>Please note that lunch is 12pm to 2pm, afternoon tea 3pm to 5pm, and dinner 6pm to 9pm. <br>If multiple time periods are desired, please specify in message area.</p>
</div>
	
<div id="container">
		<div class="grid front-row"> 
			<div class="col-1-7">
				<h2>Sunday</h2>
			</div>
			
			<div class="col-1-7">
				<h2>Monday</h2>
			</div>
			
			<div class="col-1-7">
				<h2>Tuesday</h2>
			</div>
			
			<div class="col-1-7">
				<h2>Wednesday</h2>
			</div>
			
			<div class="col-1-7">
				<h2>Thursday</h2>
			</div>
			
			<div class="col-1-7">
				<h2>Friday</h2>
			</div>
			
			<div class="col-1-7">
				<h2>Saturday</h2>
			</div>
			
		</div> 

		<div class="grid"> 
			<div class="col-1-7">
				&nbsp;
			</div>
			
			<div class="col-1-7">
				&nbsp;
			</div>
			
			<div class="col-1-7">
				&nbsp;
			</div>
			
			<div class="col-1-7">
				&nbsp;
			</div>
			
			<div class="col-1-7">
				<h2>1</h2>
				<div id="jan-1-availability" class="availability" data-day="1">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
			
			<div class="col-1-7">
				<h2>2</h2>
				<div id="jan-2-availability" class="availability" data-day="2">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
			
			<div class="col-1-7">
				<h2>3</h2>
				<div id="jan-3-availability" class="availability" data-day="3">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
		</div>
			
		<div class="grid"> 
			<div class="col-1-7">
				<h2>4</h2>
				<div id="jan-4-availability" class="availability" data-day="4">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
			
			<div class="col-1-7">
				<h2>5</h2>
				<div id="jan-5-availability" class="availability" data-day="5">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
			
			<div class="col-1-7">
				<h2>6</h2>
				<div id="jan-6-availability" class="availability" data-day="6">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
			
			<div class="col-1-7">
				<h2>7</h2>
				<div id="jan-7-availability" class="availability" data-day="7">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
			
			<div class="col-1-7">
				<h2>8</h2>
				<div id="jan-8-availability" class="availability" data-day="8">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
			
			<div class="col-1-7">
				<h2>9</h2>
				<div id="jan-9-availability" class="availability" data-day="9">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
			
			<div class="col-1-7">
				<h2>10</h2>
				<div id="jan-10-availability" class="availability" data-day="10">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
		</div>
			
		<div class="grid"> 
			<div class="col-1-7">
				<h2>11</h2>
				<div id="jan-11-availability" class="availability" data-day="11">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
			
			<div class="col-1-7">
				<h2>12</h2>
				<div id="jan-12-availability" class="availability" data-day="12">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
			
			<div class="col-1-7">
				<h2>13</h2>
				<div id="jan-13-availability" class="availability" data-day="13">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
			
			<div class="col-1-7">
				<h2>14</h2>
				<div id="jan-14-availability" class="availability" data-day="14">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
			
			<div class="col-1-7">
				<h2>15</h2>
				<div id="jan-15-availability" class="availability" data-day="15">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
			
			<div class="col-1-7">
				<h2>16</h2>
				<div id="jan-16-availability" class="availability" data-day="16">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
			
			<div class="col-1-7">
				<h2>17</h2>
				<div id="jan-17-availability" class="availability" data-day="17">
					<img src="images/lunch.png">
					<img src="images/ice-cream.png">
					<img src="images/dinner3.png">
				</div>
			</div>
		</div>	
		
</div>

<div id="openModal" class="modalDialog">
	<div>
		<a href="#close" title="Close" class="close">X</a>
		<h2 id="modal-title">Modal Box</h2>

		<div id="modal-loading">
			Loading reservations...
		</div>

		<div id="modal-content" style="display:none;">
			<form action="">
				<label for="modal-person-name">Your name:</label>
				<input id="modal-person-name" type="text" name="name"><br>

				<input id="radio-lunch" type="radio" name="meal" value="lunch">
				<label for="radio-lunch">Lunch</label><br>

				<input id="radio-afternoon-tea" type="radio" name="meal" value="afternoonTea">
				<label for="radio-afternoon-tea">Afternoon tea</label><br>

				<input id="radio-dinner" type="radio" name="meal" value="dinner">
				<label for="radio-dinner">Dinner</label><br>
				
				<label for="modal-message">Message(optional):</label>
				<input id="modal-message" type="text" name="message"><br>

				<div>
					<button type="button" id="modal-submit">Book Me</button>
				</div>
			</form>
		</div>

		<div id="modal-success" style="display:none;">
			<h2>Booked. *^_^*</h2>
		</div>
	</div>
</div>

<div id="login" class="modalDialog">

	<form action="">
		<label for="login-username">Username:</label> <input id="login-username" type="text"><br>
		<label for="login-password">Password:</label> <input id="login-password" type="password"><br>

		<div>
			<button type="button" id="login-submit">Login</button>
		</div>
	</form>
</div>

<script>
Parse.initialize("rsiGE2TI0oCXADiQTwUzB6h6cTiAWYUtLDDGTMwP", "wjSaS0qFpgQa31dsaroGUKd880pRrhvAPRThZ8fU");
</script>
<script src="bookme.js"></script>

<script>
	var availabilityDay = null;

	$('.availability img').click(function() {
		var $img = $(this),
			$parent = $img.parent();

		var imgIndex = $parent.children().index(this);
		$('#modal-content input[name=meal]').eq(imgIndex).prop('checked', true);

		availabilityDay = $parent.data('day');
		$('#modal-title').text('January ' + availabilityDay);

		showModalLoading();

		queryReservationsForDay(availabilityDay, function(reservations) {
			showModalContent();

			$('#modal-content input').show().prop('disabled', false);
			$('#modal-content button').prop('disabled', false).css('opacity', 1.0);
			$('#modal-content label').show().css('opacity', 1.0);

			// Do something with the returned Parse.Object values
			for (var i = 0; i < reservations.length; i++) {
				var reservation = reservations[i];
				var meal = reservation.get('meal');
				if (meal == 'lunch') {
					$('#radio-lunch').prop('disabled', true);
					$('label[for=radio-lunch]').css('opacity', 0.4);
				} else if (meal == 'afternoonTea') {
					$('#radio-afternoon-tea').prop('disabled', true);
					$('label[for=radio-afternoon-tea]').css('opacity', 0.4);
				} else if (meal == 'dinner') {
					$('#radio-dinner').prop('disabled', true);
					$('label[for=radio-dinner]').css('opacity', 0.4);
				}
			}
		});

		window.location.hash = 'openModal';
	});

	$('#modal-content button').click(function() {
		var name = $('#modal-person-name').val();
		var $selectedRadio = $('#modal-content input[name=meal]:checked');
		if (name.length && $selectedRadio.length) {
			var meal = $selectedRadio.val();
			
			$('#modal-content input').prop('disabled', true);
			$('#modal-content button').prop('disabled', true).css('opacity', 0.4);

			saveReservation(name, availabilityDay, meal, function(reservation) {
				var $content = $('#modal-content');
				showModalSuccess();
				refreshCalendarReservations();
			});
		}
	});

	$('#mouth').dblclick(function() {
		window.location.hash = 'login';
	});

	$('#login-submit').click(function() {
		var username = $('#login-username').val();
		var password = $('#login-password').val();
		Parse.User.logIn(username, password, {
			success: function(user) {
				// Do stuff after successful login.
				refreshCalendarReservations();
				window.location.hash = 'close';
			},
			error: function(user, error) {
				// The login failed. Check error to see why.
				alert('error: ' + error.message);
			}
		});
	});

	refreshCalendarReservations();

	window.onload = function() {
		window.location.hash = '';
	}
</script>

</body>